#include "stm32f4xx.h"
#include "variables.h"
#include <math.h>


/***********************************************************************/
//                          Structure declarations
/***********************************************************************/
volatile struct PLL_Variables pll = {
    .Theta          = 0.0f,
    .freq           = 0.0f,
    .freq_ff        = 50.0f,
    .Vq_out_filtered= 0.0f,
    .theta_prev     = 0.0f,
    .integrator     = 0.0f,
    .Vq_prev        = 0.0f,
    .Vq_filtered    = 0.0f,
    .cos_theta      = 0.0f,
    .sin_theta      = 0.0f,
    .error          = 0.0f,
    .max_corr_rad   = 0.0f,
    .w_corr         = 0.0f,
    .w_nom          = 0.0f,
    .w              = 0.0f,
    .w_min          = 0.0f,
    .w_max          = 0.0f,
    .alpha          = 0.005f,
    .Kp             = 0.006f,
    .Ki             = 0.012f,
	.intialized     = 0,
	.Ts             = 100e-6f,
	.debugVariable1 = 0.0f,
	.debugVariable2 = 0.0f,
	.lockCount      = 0,
	.treshold_time  = 100000,
};

volatile struct V_Grid_Variables grid = {
		.Ia     = 606.0f,
		.Ib     = 606.0f,
		.Ic     = 100.0f,
		.Va     = 0.0f,
		.Vb     = 0.0f,
		.Vc     = 0.0f,
		.V_alpha= 0.0f,
		.V_beta = 0.0f,
		.Id     = 0.0f,
		.Iq     = 0.0f,
		.Vd     = 0.0f,
		.Vq     = 0.0f,
};

//Timer3 Control-parameters
volatile struct Timer3_Variables timer3_variables={
	.sample_index   = 0,
	.Tim3_ARR_Value = 55
};

//Voltage Control-parameters
volatile struct Voltage_Controller_Variables voltage_ctrl = {
	.Vdc_ref          = 700.0f,
	.Vdc_actual       = 700.0f,
	.Id_ref_max       = 10.0f,
	.Id_ref           = 0.0f,
	.I_term_clamped   = 0.0f,
	.integral_error   = 0.0f,
	.I_term_candidate = 0.0f,
	.P_term           = 0.0f,
	.error            = 0.0f,
	.Kp               = 0.5f,
	.Ki               = 100.0f,

};

//Current Control-parameters
volatile struct Current_Controller_Variables current_ctrl={
		.L        = 0.0f,
		.C        = 0.0f,
		.Vd_ff    = 0.0f,
		.Vq_ff    = 0.0f,
		.Iq_ref   = 0.0f,
		.Id       = 0.0f,
		.Iq       = 0.0f,
		.Vd_out   = 0.0f,
		.Vq_out   = 0.0f,
		.deltaV_d = 0.0f,
		.deltaV_q = 0.0f,
		.Vlimit   = 30.0f,
		.err_Id   = 0.0f,
		.err_Iq   = 0.0f,
		.int_Id   = 0.0f,
		.int_Iq   = 0.0f,
		.Kp       = 50.5f,
		.Ki       = 100.0f
};

// Upper Cut-Off Limits
volatile struct Limit_Parameters UCoffLimit = {
    .Va_rms  = 800,
    .Vb_rms  = 800,
    .Vc_rms  = 800,
    .Va_inst = 900,
    .Vb_inst = 900,
    .Vc_inst = 900,
    .Ia_rms  = 150,
    .Ib_rms  = 150,
    .Ic_rms  = 150,
    .Ia_inst = 180,
    .Ib_inst = 180,
    .Ic_inst = 180,
    .Vdc_avg = 800,
    .Vdc_inst= 850,
    .Idc_avg = 120,
    .Idc_inst= 150
};

// Upper Cut-In Limits
volatile struct Limit_Parameters UCinLimit = {
    .Va_rms  = 400,
    .Vb_rms  = 400,
    .Vc_rms  = 400,
    .Va_inst = 450,
    .Vb_inst = 450,
    .Vc_inst = 450,
    .Ia_rms  = 50,
    .Ib_rms  = 50,
    .Ic_rms  = 50,
    .Ia_inst = 60,
    .Ib_inst = 60,
    .Ic_inst = 60,
    .Vdc_avg = 380,
    .Vdc_inst= 400,
    .Idc_avg = 40,
    .Idc_inst= 50
};

// Lower Cut-Off Limits
volatile struct Limit_Parameters LCoffLimit = {
    .Va_rms  = 150,
    .Vb_rms  = 150,
    .Vc_rms  = 150,
    .Va_inst = 100,
    .Vb_inst = 100,
    .Vc_inst = 100,
    .Ia_rms  = 10,
    .Ib_rms  = 10,
    .Ic_rms  = 10,
    .Ia_inst = 5,
    .Ib_inst = 5,
    .Ic_inst = 5,
    .Vdc_avg = 150,
    .Vdc_inst= 100,
    .Idc_avg = 5,
    .Idc_inst= 2
};

// Lower Cut-In Limits
volatile struct Limit_Parameters LCinLimit = {
    .Va_rms  = 200,
    .Vb_rms  = 200,
    .Vc_rms  = 200,
    .Va_inst = 220,
    .Vb_inst = 220,
    .Vc_inst = 220,
    .Ia_rms  = 20,
    .Ib_rms  = 20,
    .Ic_rms  = 20,
    .Ia_inst = 25,
    .Ib_inst = 25,
    .Ic_inst = 25,
    .Vdc_avg = 180,
    .Vdc_inst= 200,
    .Idc_avg = 10,
    .Idc_inst= 15
};


volatile struct dq_to_abc abc_form={0};

volatile struct RMS_Variables rmsVal={0.0f};
volatile struct Instantaneous_Variables instVal={0.0f};
volatile struct Average_Variables avgVal={0.0f};
volatile struct ErrorFlags error_flags={0};
volatile struct Counters counters={0};


volatile uint32_t tick_counter = 0;
volatile uint16_t adc_buffer[ADC_LENGHT];

volatile StateControl state = state0;

volatile uint32_t delay_time = 0;
volatile bool relayOff_counter_enable = 0;
//
volatile uint32_t first_time_state_entry=0;



/***********************************************************************/
//                          PLL Va, Vb, Vc Array
/***********************************************************************/
const float va_array[]= {
	    0.0f, 6.980962575f, 13.95979868f, 20.9343825f, 27.9025895f, 34.8622971f,
	    41.81138531f, 48.74773736f, 55.66924038f, 62.57378602f, 69.45927107f,
	    76.32359815f, 83.16467633f, 89.98042174f, 96.76875824f, 103.527618f,
	    110.2549423f, 116.9486819f, 123.6067977f, 130.2272618f, 136.8080573f,
	    143.3471798f, 149.8426374f, 156.2924514f, 162.6946572f, 169.0473047f,
	    175.3484587f, 181.5961999f, 187.7886251f, 193.9238481f, 200.0f,
	    206.01523f, 211.9677057f, 217.855614f, 223.6771614f, 229.4305745f,
	    235.1141009f, 240.7260093f, 246.2645901f, 251.7281564f, 257.1150439f,
	    262.4236116f, 267.6522425f, 272.799344f, 277.8633482f, 282.8427125f,
	    287.7359201f, 292.5414806f, 297.2579302f, 301.8838321f, 306.4177772f,
	    310.8583846f, 315.2043014f, 319.454204f, 323.6067977f, 327.6608177f,
	    331.615029f, 335.4682272f, 339.2192385f, 342.8669203f, 346.4101615f,
	    349.8478829f, 353.1790371f, 356.4026097f, 359.5176185f, 362.5231148f,
	    365.4181831f, 368.2019414f, 370.8735418f, 373.4321706f, 375.8770483f,
	    378.2074302f, 380.4226065f, 382.5219024f, 384.5046784f, 386.3703305f,
	    388.1182905f, 389.7480259f, 391.2590403f, 392.6508734f, 393.9231012f,
	    395.0753362f, 396.1072275f, 397.0184607f, 397.8087581f, 398.4778792f,
	    399.0256201f, 399.4518139f, 399.7563308f, 399.9390781f, 400.0f,
	    399.9390781f, 399.7563308f, 399.4518139f, 399.0256201f, 398.4778792f,
	    397.8087581f, 397.0184607f, 396.1072275f, 395.0753362f, 393.9231012f,
	    392.6508734f, 391.2590403f, 389.7480259f, 388.1182905f, 386.3703305f,
	    384.5046784f, 382.5219024f, 380.4226065f, 378.2074302f, 375.8770483f,
	    373.4321706f, 370.8735418f, 368.2019414f, 365.4181831f, 362.5231148f,
	    359.5176185f, 356.4026097f, 353.1790371f, 349.8478829f, 346.4101615f,
	    342.8669203f, 339.2192385f, 335.4682272f, 331.615029f, 327.6608177f,
	    323.6067977f, 319.454204f, 315.2043014f, 310.8583846f, 306.4177772f,
	    301.8838321f, 297.2579302f, 292.5414806f, 287.7359201f, 282.8427125f,
	    277.8633482f, 272.799344f, 267.6522425f, 262.4236116f, 257.1150439f,
	    251.7281564f, 246.2645901f, 240.7260093f, 235.1141009f, 229.4305745f,
	    223.6771614f, 217.855614f, 211.9677057f, 206.01523f, 200.0f,
	    193.9238481f, 187.7886251f, 181.5961999f, 175.3484587f, 169.0473047f,
	    162.6946572f, 156.2924514f, 149.8426374f, 143.3471798f, 136.8080573f,
	    130.2272618f, 123.6067977f, 116.9486819f, 110.2549423f, 103.527618f,
	    96.76875824f, 89.98042174f, 83.16467633f, 76.32359815f, 69.45927107f,
	    62.57378602f, 55.66924038f, 48.74773736f, 41.81138531f, 34.8622971f,
	    27.9025895f, 20.9343825f, 13.95979868f, 6.980962575f, 0.0f,
	   -6.980962575f, -13.95979868f, -20.9343825f, -27.9025895f, -34.8622971f,
	   -41.81138531f, -48.74773736f, -55.66924038f, -62.57378602f, -69.45927107f,
	   -76.32359815f, -83.16467633f, -89.98042174f, -96.76875824f, -103.527618f,
	   -110.2549423f, -116.9486819f, -123.6067977f, -130.2272618f, -136.8080573f,
	   -143.3471798f, -149.8426374f, -156.2924514f, -162.6946572f, -169.0473047f,
	   -175.3484587f, -181.5961999f, -187.7886251f, -193.9238481f, -200.0f,
	   -206.01523f, -211.9677057f, -217.855614f, -223.6771614f, -229.4305745f,
	   -235.1141009f, -240.7260093f, -246.2645901f, -251.7281564f, -257.1150439f,
	   -262.4236116f, -267.6522425f, -272.799344f, -277.8633482f, -282.8427125f,
	   -287.7359201f, -292.5414806f, -297.2579302f, -301.8838321f, -306.4177772f,
	   -310.8583846f, -315.2043014f, -319.454204f, -323.6067977f, -327.6608177f,
	   -331.615029f, -335.4682272f, -339.2192385f, -342.8669203f, -346.4101615f,
	   -349.8478829f, -353.1790371f, -356.4026097f, -359.5176185f, -362.5231148f,
	   -365.4181831f, -368.2019414f, -370.8735418f, -373.4321706f, -375.8770483f,
	   -378.2074302f, -380.4226065f, -382.5219024f, -384.5046784f, -386.3703305f,
	   -388.1182905f, -389.7480259f, -391.2590403f, -392.6508734f, -393.9231012f,
	   -395.0753362f, -396.1072275f, -397.0184607f, -397.8087581f, -398.4778792f,
	   -399.0256201f, -399.4518139f, -399.7563308f, -399.9390781f, -400.0f,
	   -399.9390781f, -399.7563308f, -399.4518139f, -399.0256201f, -398.4778792f,
	   -397.8087581f, -397.0184607f, -396.1072275f, -395.0753362f, -393.9231012f,
	   -392.6508734f, -391.2590403f, -389.7480259f, -388.1182905f, -386.3703305f,
	   -384.5046784f, -382.5219024f, -380.4226065f, -378.2074302f, -375.8770483f,
	   -373.4321706f, -370.8735418f, -368.2019414f, -365.4181831f, -362.5231148f,
	   -359.5176185f, -356.4026097f, -353.1790371f, -349.8478829f, -346.4101615f,
	   -342.8669203f, -339.2192385f, -335.4682272f, -331.615029f, -327.6608177f,
	   -323.6067977f, -319.454204f, -315.2043014f, -310.8583846f, -306.4177772f,
	   -301.8838321f, -297.2579302f, -292.5414806f, -287.7359201f, -282.8427125f,
	   -277.8633482f, -272.799344f, -267.6522425f, -262.4236116f, -257.1150439f,
	   -251.7281564f, -246.2645901f, -240.7260093f, -235.1141009f, -229.4305745f,
	   -223.6771614f, -217.855614f, -211.9677057f, -206.01523f, -200.0f,
	   -193.9238481f, -187.7886251f, -181.5961999f, -175.3484587f, -169.0473047f,
	   -162.6946572f, -156.2924514f, -149.8426374f, -143.3471798f, -136.8080573f,
	   -130.2272618f, -123.6067977f, -116.9486819f, -110.2549423f, -103.527618f,
	   -96.76875824f, -89.98042174f, -83.16467633f, -76.32359815f, -69.45927107f,
	   -62.57378602f, -55.66924038f, -48.74773736f, -41.81138531f, -34.8622971f,
	   -27.9025895f, -20.9343825f, -13.95979868f, -6.980962575f
	};



const float vb_array[]= {
	    -346.4101615f, -349.8478829f, -353.1790371f, -356.4026097f, -359.5176185f, -362.5231148f,
	    -365.4181831f, -368.2019414f, -370.8735418f, -373.4321706f, -375.8770483f, -378.2074302f,
	    -380.4226065f, -382.5219024f, -384.5046784f, -386.3703305f, -388.1182905f, -389.7480259f,
	    -391.2590403f, -392.6508734f, -393.9231012f, -395.0753362f, -396.1072275f, -397.0184607f,
	    -397.8087581f, -398.4778792f, -399.0256201f, -399.4518139f, -399.7563308f, -399.9390781f,
	    -400.0000000f, -399.9390781f, -399.7563308f, -399.4518139f, -399.0256201f, -398.4778792f,
	    -397.8087581f, -397.0184607f, -396.1072275f, -395.0753362f, -393.9231012f, -392.6508734f,
	    -391.2590403f, -389.7480259f, -388.1182905f, -386.3703305f, -384.5046784f, -382.5219024f,
	    -380.4226065f, -378.2074302f, -375.8770483f, -373.4321706f, -370.8735418f, -368.2019414f,
	    -365.4181831f, -362.5231148f, -359.5176185f, -356.4026097f, -353.1790371f, -349.8478829f,
	    -346.4101615f, -342.8669203f, -339.2192385f, -335.4682272f, -331.6150290f, -327.6608177f,
	    -323.6067977f, -319.4542040f, -315.2043014f, -310.8583846f, -306.4177772f, -301.8838321f,
	    -297.2579302f, -292.5414806f, -287.7359201f, -282.8427125f, -277.8633482f, -272.7993440f,
	    -267.6522425f, -262.4236116f, -257.1150439f, -251.7281564f, -246.2645901f, -240.7260093f,
	    -235.1141009f, -229.4305745f, -223.6771614f, -217.8556140f, -211.9677057f, -206.0152300f,
	    -200.0000000f, -193.9238481f, -187.7886251f, -181.5961999f, -175.3484587f, -169.0473047f,
	    -162.6946572f, -156.2924514f, -149.8426374f, -143.3471798f, -136.8080573f, -130.2272618f,
	    -123.6067977f, -116.9486819f, -110.2549423f, -103.5276180f,  -96.7687582f,  -89.9804217f,
	     -83.1646763f,  -76.3235981f,  -69.4592711f,  -62.5737860f,  -55.6692404f,  -48.7477374f,
	     -41.8113853f,  -34.8622971f,  -27.9025895f,  -20.9343825f,  -13.9597987f,   -6.9809626f,
	       0.0000000f,    6.9809626f,   13.9597987f,   20.9343825f,   27.9025895f,   34.8622971f,
	      41.8113853f,   48.7477374f,   55.6692404f,   62.5737860f,   69.4592711f,   76.3235981f,
	      83.1646763f,   89.9804217f,   96.7687582f,  103.5276180f,  110.2549423f,  116.9486819f,
	     123.6067977f,  130.2272618f,  136.8080573f,  143.3471798f,  149.8426374f,  156.2924514f,
	     162.6946572f,  169.0473047f,  175.3484587f,  181.5961999f,  187.7886251f,  193.9238481f,
	     200.0000000f,  206.0152300f,  211.9677057f,  217.8556140f,  223.6771614f,  229.4305745f,
	     235.1141009f,  240.7260093f,  246.2645901f,  251.7281564f,  257.1150439f,  262.4236116f,
	     267.6522425f,  272.7993440f,  277.8633482f,  282.8427125f,  287.7359201f,  292.5414806f,
	     297.2579302f,  301.8838321f,  306.4177772f,  310.8583846f,  315.2043014f,  319.4542040f,
	     323.6067977f,  327.6608177f,  331.6150290f,  335.4682272f,  339.2192385f,  342.8669203f,
	     346.4101615f,  349.8478829f,  353.1790371f,  356.4026097f,  359.5176185f,  362.5231148f,
	     365.4181831f,  368.2019414f,  370.8735418f,  373.4321706f,  375.8770483f,  378.2074302f,
	     380.4226065f,  382.5219024f,  384.5046784f,  386.3703305f,  388.1182905f,  389.7480259f,
	     391.2590403f,  392.6508734f,  393.9231012f,  395.0753362f,  396.1072275f,  397.0184607f,
	     397.8087581f,  398.4778792f,  399.0256201f,  399.4518139f,  399.7563308f,  399.9390781f,
	     400.0000000f,  399.9390781f,  399.7563308f,  399.4518139f,  399.0256201f,  398.4778792f,
	     397.8087581f,  397.0184607f,  396.1072275f,  395.0753362f,  393.9231012f,  392.6508734f,
	     391.2590403f,  389.7480259f,  388.1182905f,  386.3703305f,  384.5046784f,  382.5219024f,
	     380.4226065f,  378.2074302f,  375.8770483f,  373.4321706f,  370.8735418f,  368.2019414f,
	     365.4181831f,  362.5231148f,  359.5176185f,  356.4026097f,  353.1790371f,  349.8478829f,
	     346.4101615f,  342.8669203f,  339.2192385f,  335.4682272f,  331.6150290f,  327.6608177f,
	     323.6067977f,  319.4542040f,  315.2043014f,  310.8583846f,  306.4177772f,  301.8838321f,
	     297.2579302f,  292.5414806f,  287.7359201f,  282.8427125f,  277.8633482f,  272.7993440f,
	     267.6522425f,  262.4236116f,  257.1150439f,  251.7281564f,  246.2645901f,  240.7260093f,
	     235.1141009f,  229.4305745f,  223.6771614f,  217.8556140f,  211.9677057f,  206.0152300f,
	     200.0000000f,  193.9238481f,  187.7886251f,  181.5961999f,  175.3484587f,  169.0473047f,
	     162.6946572f,  156.2924514f,  149.8426374f,  143.3471798f,  136.8080573f,  130.2272618f,
	     123.6067977f,  116.9486819f,  110.2549423f,  103.5276180f,   96.7687582f,   89.9804217f,
	      83.1646763f,   76.3235981f,   69.4592711f,   62.5737860f,   55.6692404f,   48.7477374f,
	      41.8113853f,   34.8622971f,   27.9025895f,   20.9343825f,   13.9597987f,    6.9809626f,
	       0.0000000f,   -6.9809626f,  -13.9597987f,  -20.9343825f,  -27.9025895f,  -34.8622971f,
	     -41.8113853f,  -48.7477374f,  -55.6692404f,  -62.5737860f,  -69.4592711f,  -76.3235981f,
	     -83.1646763f,  -89.9804217f,  -96.7687582f, -103.5276180f, -110.2549423f, -116.9486819f,
	    -123.6067977f, -130.2272618f, -136.8080573f, -143.3471798f, -149.8426374f, -156.2924514f,
	    -162.6946572f, -169.0473047f, -175.3484587f, -181.5961999f, -187.7886251f, -193.9238481f,
	    -200.0000000f, -206.0152300f, -211.9677057f, -217.8556140f, -223.6771614f, -229.4305745f,
	    -235.1141009f, -240.7260093f, -246.2645901f, -251.7281564f, -257.1150439f, -262.4236116f,
	    -267.6522425f, -272.7993440f, -277.8633482f, -282.8427125f, -287.7359201f, -292.5414806f,
	    -297.2579302f, -301.8838321f, -306.4177772f, -310.8583846f, -315.2043014f, -319.4542040f,
	    -323.6067977f, -327.6608177f, -331.6150290f, -335.4682272f, -339.2192385f, -342.8669203f
	};

const float vc_array[] = {
    346.4101615f, 342.8669203f, 339.2192385f, 335.4682272f, 331.6150290f, 327.6608177f,
    323.6067977f, 319.4542040f, 315.2043014f, 310.8583846f, 306.4177772f, 301.8838321f,
    297.2579302f, 292.5414806f, 287.7359201f, 282.8427125f, 277.8633482f, 272.7993440f,
    267.6522425f, 262.4236116f, 257.1150439f, 251.7281564f, 246.2645901f, 240.7260093f,
    235.1141009f, 229.4305745f, 223.6771614f, 217.8556140f, 211.9677057f, 206.0152300f,
    200.0000000f, 193.9238481f, 187.7886251f, 181.5961999f, 175.3484587f, 169.0473047f,
    162.6946572f, 156.2924514f, 149.8426374f, 143.3471798f, 136.8080573f, 130.2272618f,
    123.6067977f, 116.9486819f, 110.2549423f, 103.5276180f,  96.7687582f,  89.9804217f,
     83.1646763f,  76.3235982f,  69.4592711f,  62.5737860f,  55.6692404f,  48.7477374f,
     41.8113853f,  34.8622971f,  27.9025895f,  20.9343825f,  13.9597987f,   6.9809626f,
      0.0000000f,  -6.9809626f, -13.9597987f, -20.9343825f, -27.9025895f, -34.8622971f,
    -41.8113853f, -48.7477374f, -55.6692404f, -62.5737860f, -69.4592711f, -76.3235982f,
    -83.1646763f, -89.9804217f, -96.7687582f,-103.5276180f,-110.2549423f,-116.9486819f,
   -123.6067977f,-130.2272618f,-136.8080573f,-143.3471798f,-149.8426374f,-156.2924514f,
   -162.6946572f,-169.0473047f,-175.3484587f,-181.5961999f,-187.7886251f,-193.9238481f,
   -200.0000000f,-206.0152300f,-211.9677057f,-217.8556140f,-223.6771614f,-229.4305745f,
   -235.1141009f,-240.7260093f,-246.2645901f,-251.7281564f,-257.1150439f,-262.4236116f,
   -267.6522425f,-272.7993440f,-277.8633482f,-282.8427125f,-287.7359201f,-292.5414806f,
   -297.2579302f,-301.8838321f,-306.4177772f,-310.8583846f,-315.2043014f,-319.4542040f,
   -323.6067977f,-327.6608177f,-331.6150290f,-335.4682272f,-339.2192385f,-342.8669203f,
   -346.4101615f,-349.8478829f,-353.1790371f,-356.4026097f,-359.5176185f,-362.5231148f,
   -365.4181831f,-368.2019414f,-370.8735418f,-373.4321706f,-375.8770483f,-378.2074302f,
   -380.4226065f,-382.5219024f,-384.5046784f,-386.3703305f,-388.1182905f,-389.7480259f,
   -391.2590403f,-392.6508734f,-393.9231012f,-395.0753362f,-396.1072275f,-397.0184607f,
   -397.8087581f,-398.4778792f,-399.0256201f,-399.4518139f,-399.7563308f,-399.9390781f,
   -400.0000000f,-399.9390781f,-399.7563308f,-399.4518139f,-399.0256201f,-398.4778792f,
   -397.8087581f,-397.0184607f,-396.1072275f,-395.0753362f,-393.9231012f,-392.6508734f,
   -391.2590403f,-389.7480259f,-388.1182905f,-386.3703305f,-384.5046784f,-382.5219024f,
   -380.4226065f,-378.2074302f,-375.8770483f,-373.4321706f,-370.8735418f,-368.2019414f,
   -365.4181831f,-362.5231148f,-359.5176185f,-356.4026097f,-353.1790371f,-349.8478829f,
   -346.4101615f,-342.8669203f,-339.2192385f,-335.4682272f,-331.6150290f,-327.6608177f,
   -323.6067977f,-319.4542040f,-315.2043014f,-310.8583846f,-306.4177772f,-301.8838321f,
   -297.2579302f,-292.5414806f,-287.7359201f,-282.8427125f,-277.8633482f,-272.7993440f,
   -267.6522425f,-262.4236116f,-257.1150439f,-251.7281564f,-246.2645901f,-240.7260093f,
   -235.1141009f,-229.4305745f,-223.6771614f,-217.8556140f,-211.9677057f,-206.0152300f,
   -200.0000000f,-193.9238481f,-187.7886251f,-181.5961999f,-175.3484587f,-169.0473047f,
   -162.6946572f,-156.2924514f,-149.8426374f,-143.3471798f,-136.8080573f,-130.2272618f,
   -123.6067977f,-116.9486819f,-110.2549423f,-103.5276180f, -96.7687582f, -89.9804217f,
    -83.1646763f, -76.3235982f, -69.4592711f, -62.5737860f, -55.6692404f, -48.7477374f,
    -41.8113853f, -34.8622971f, -27.9025895f, -20.9343825f, -13.9597987f,  -6.9809626f,
      0.0000000f,   6.9809626f,  13.9597987f,  20.9343825f,  27.9025895f,  34.8622971f,
     41.8113853f,  48.7477374f,  55.6692404f,  62.5737860f,  69.4592711f,  76.3235982f,
     83.1646763f,  89.9804217f,  96.7687582f, 103.5276180f, 110.2549423f, 116.9486819f,
    123.6067977f, 130.2272618f, 136.8080573f, 143.3471798f, 149.8426374f, 156.2924514f,
    162.6946572f, 169.0473047f, 175.3484587f, 181.5961999f, 187.7886251f, 193.9238481f,
    200.0000000f, 206.0152300f, 211.9677057f, 217.8556140f, 223.6771614f, 229.4305745f,
    235.1141009f, 240.7260093f, 246.2645901f, 251.7281564f, 257.1150439f, 262.4236116f,
    267.6522425f, 272.7993440f, 277.8633482f, 282.8427125f, 287.7359201f, 292.5414806f,
    297.2579302f, 301.8838321f, 306.4177772f, 310.8583846f, 315.2043014f, 319.4542040f,
    323.6067977f, 327.6608177f, 331.6150290f, 335.4682272f, 339.2192385f, 342.8669203f,
    346.4101615f, 349.8478829f, 353.1790371f, 356.4026097f, 359.5176185f, 362.5231148f,
    365.4181831f, 368.2019414f, 370.8735418f, 373.4321706f, 375.8770483f, 378.2074302f,
    380.4226065f, 382.5219024f, 384.5046784f, 386.3703305f, 388.1182905f, 389.7480259f,
    391.2590403f, 392.6508734f, 393.9231012f, 395.0753362f, 396.1072275f, 397.0184607f,
    397.8087581f, 398.4778792f, 399.0256201f, 399.4518139f, 399.7563308f, 399.9390781f,
    400.0000000f, 399.9390781f, 399.7563308f, 399.4518139f, 399.0256201f, 398.4778792f,
    397.8087581f, 397.0184607f, 396.1072275f, 395.0753362f, 393.9231012f, 392.6508734f,
    391.2590403f, 389.7480259f, 388.1182905f, 386.3703305f, 384.5046784f, 382.5219024f,
    380.4226065f, 378.2074302f, 375.8770483f, 373.4321706f, 370.8735418f, 368.2019414f,
    365.4181831f, 362.5231148f, 359.5176185f, 356.4026097f, 353.1790371f, 349.8478829f
};





//const float va_array[] = {
//    0.0f, 3.926791448f, 7.852386758f, 11.77559015f, 15.69520659f,
//    19.61004212f, 23.51890424f, 27.42060227f, 31.31394772f, 35.19775463f,
//    39.07083998f, 42.93202396f, 46.78013043f, 50.61398723f, 54.43242651f,
//    58.23428515f, 62.01840506f, 65.78363356f, 69.52882373f, 73.25283475f,
//    76.95453225f, 80.63278865f, 84.28648352f, 87.91450391f, 91.51574469f,
//    95.08910889f, 98.63350803f, 102.1478624f, 105.6311016f, 109.0821646f,
//    112.5f, 115.8835669f, 119.2318345f, 122.5437829f, 125.8184033f,
//    129.0546982f, 132.2516818f, 135.4083802f, 138.5238319f, 141.597088f,
//    144.6272122f, 147.6132815f, 150.5543864f, 153.449631f, 156.2981334f,
//    159.0990258f, 161.8514551f, 164.5545829f, 167.2075857f, 169.8096556f,
//    172.3599997f, 174.8578413f, 177.3024196f, 179.6929898f, 182.0288237f,
//    184.30921f, 186.5334538f, 188.7008778f, 190.8108216f, 192.8626427f,
//    194.8557159f, 196.7894341f, 198.6632084f, 200.4764679f, 202.2286604f,
//    203.9192521f, 205.547728f, 207.113592f, 208.6163673f, 210.055596f,
//    211.4308397f, 212.7416795f, 213.9877162f, 215.1685701f, 216.2838816f,
//    217.3333109f, 218.3165384f, 219.2332646f, 220.0832102f, 220.8661163f,
//    221.5817444f, 222.2298766f, 222.8103155f, 223.3228841f, 223.7674265f,
//    224.1438071f, 224.4519113f, 224.6916453f, 224.8629361f, 224.9657314f,
//    225.0f, 224.9657314f, 224.8629361f, 224.6916453f, 224.4519113f,
//    224.1438071f, 223.7674265f, 223.3228841f, 222.8103155f, 222.2298766f,
//    221.5817444f, 220.8661163f, 220.0832102f, 219.2332646f, 218.3165384f,
//    217.3333109f, 216.2838816f, 215.1685701f, 213.9877162f, 212.7416795f,
//    211.4308397f, 210.055596f, 208.6163673f, 207.113592f, 205.547728f,
//    203.9192521f, 202.2286604f, 200.4764679f, 198.6632084f, 196.7894341f,
//    194.8557159f, 192.8626427f, 190.8108216f, 188.7008778f, 186.5334538f,
//    184.30921f, 182.0288237f, 179.6929898f, 177.3024196f, 174.8578413f,
//    172.3599997f, 169.8096556f, 167.2075857f, 164.5545829f, 161.8514551f,
//    159.0990258f, 156.2981334f, 153.449631f, 150.5543864f, 147.6132815f,
//    144.6272122f, 141.597088f, 138.5238319f, 135.4083802f, 132.2516818f,
//    129.0546982f, 125.8184033f, 122.5437829f, 119.2318345f, 115.8835669f,
//    112.5f, 109.0821646f, 105.6311016f, 102.1478624f, 98.63350803f,
//    95.08910889f, 91.51574469f, 87.91450391f, 84.28648352f, 80.63278865f,
//    76.95453225f, 73.25283475f, 69.52882373f, 65.78363356f, 62.01840506f,
//    58.23428515f, 54.43242651f, 50.61398723f, 46.78013043f, 42.93202396f,
//    39.07083998f, 35.19775463f, 31.31394772f, 27.42060227f, 23.51890424f,
//    19.61004212f, 15.69520659f, 11.77559015f, 7.852386758f, 3.926791448f,
//    0.0f, -3.926791448f, -7.852386758f, -11.77559015f, -15.69520659f,
//    -19.61004212f, -23.51890424f, -27.42060227f, -31.31394772f, -35.19775463f,
//    -39.07083998f, -42.93202396f, -46.78013043f, -50.61398723f, -54.43242651f,
//    -58.23428515f, -62.01840506f, -65.78363356f, -69.52882373f, -73.25283475f,
//    -76.95453225f, -80.63278865f, -84.28648352f, -87.91450391f, -91.51574469f,
//    -95.08910889f, -98.63350803f, -102.1478624f, -105.6311016f, -109.0821646f,
//    -112.5f, -115.8835669f, -119.2318345f, -122.5437829f, -125.8184033f,
//    -129.0546982f, -132.2516818f, -135.4083802f, -138.5238319f, -141.597088f,
//    -144.6272122f, -147.6132815f, -150.5543864f, -153.449631f, -156.2981334f,
//    -159.0990258f, -161.8514551f, -164.5545829f, -167.2075857f, -169.8096556f,
//    -172.3599997f, -174.8578413f, -177.3024196f, -179.6929898f, -182.0288237f,
//    -184.30921f, -186.5334538f, -188.7008778f, -190.8108216f, -192.8626427f,
//    -194.8557159f, -196.7894341f, -198.6632084f, -200.4764679f, -202.2286604f,
//    -203.9192521f, -205.547728f, -207.113592f, -208.6163673f, -210.055596f,
//    -211.4308397f, -212.7416795f, -213.9877162f, -215.1685701f, -216.2838816f,
//    -217.3333109f, -218.3165384f, -219.2332646f, -220.0832102f, -220.8661163f,
//    -221.5817444f, -222.2298766f, -222.8103155f, -223.3228841f, -223.7674265f,
//    -224.1438071f, -224.4519113f, -224.6916453f, -224.8629361f, -224.9657314f,
//    -225.0f, -224.9657314f, -224.8629361f, -224.6916453f, -224.4519113f,
//    -224.1438071f, -223.7674265f, -223.3228841f, -222.8103155f, -222.2298766f,
//    -221.5817444f, -220.8661163f, -220.0832102f, -219.2332646f, -218.3165384f,
//    -217.3333109f, -216.2838816f, -215.1685701f, -213.9877162f, -212.7416795f,
//    -211.4308397f, -210.055596f, -208.6163673f, -207.113592f, -205.547728f,
//    -203.9192521f, -202.2286604f, -200.4764679f, -198.6632084f, -196.7894341f,
//    -194.8557159f, -192.8626427f, -190.8108216f, -188.7008778f, -186.5334538f,
//    -184.30921f, -182.0288237f, -179.6929898f, -177.3024196f, -174.8578413f,
//    -172.3599997f, -169.8096556f, -167.2075857f, -164.5545829f, -161.8514551f,
//    -159.0990258f, -156.2981334f, -153.449631f, -150.5543864f, -147.6132815f,
//    -144.6272122f, -141.597088f, -138.5238319f, -135.4083802f, -132.2516818f,
//    -129.0546982f, -125.8184033f, -122.5437829f, -119.2318345f, -115.8835669f,
//    -112.5f, -109.0821646f, -105.6311016f, -102.1478624f, -98.63350803f,
//    -95.08910889f, -91.51574469f, -87.91450391f, -84.28648352f, -80.63278865f,
//    -76.95453225f, -73.25283475f, -69.52882373f, -65.78363356f, -62.01840506f,
//    -58.23428515f, -54.43242651f, -50.61398723f, -46.78013043f, -42.93202396f,
//    -39.07083998f, -35.19775463f, -31.31394772f, -27.42060227f, -23.51890424f,
//    -19.61004212f, -15.69520659f, -11.77559015f, -7.852386758f, -3.926791448f
//};
//
//
//const float vb_array[] = {
//    -194.8557159f, -196.7894341f, -198.6632084f, -200.4764679f, -202.2286604f,
//    -203.9192521f, -205.547728f, -207.113592f, -208.6163673f, -210.055596f,
//    -211.4308397f, -212.7416795f, -213.9877162f, -215.1685701f, -216.2838816f,
//    -217.3333109f, -218.3165384f, -219.2332646f, -220.0832102f, -220.8661163f,
//    -221.5817444f, -222.2298766f, -222.8103155f, -223.3228841f, -223.7674265f,
//    -224.1438071f, -224.4519113f, -224.6916453f, -224.8629361f, -224.9657314f,
//    -225.0f, -224.9657314f, -224.8629361f, -224.6916453f, -224.4519113f,
//    -224.1438071f, -223.7674265f, -223.3228841f, -222.8103155f, -222.2298766f,
//    -221.5817444f, -220.8661163f, -220.0832102f, -219.2332646f, -218.3165384f,
//    -217.3333109f, -216.2838816f, -215.1685701f, -213.9877162f, -212.7416795f,
//    -211.4308397f, -210.055596f, -208.6163673f, -207.113592f, -205.547728f,
//    -203.9192521f, -202.2286604f, -200.4764679f, -198.6632084f, -196.7894341f,
//    -194.8557159f, -192.8626427f, -190.8108216f, -188.7008778f, -186.5334538f,
//    -184.30921f, -182.0288237f, -179.6929898f, -177.3024196f, -174.8578413f,
//    -172.3599997f, -169.8096556f, -167.2075857f, -164.5545829f, -161.8514551f,
//    -159.0990258f, -156.2981334f, -153.449631f, -150.5543864f, -147.6132815f,
//    -144.6272122f, -141.597088f, -138.5238319f, -135.4083802f, -132.2516818f,
//    -129.0546982f, -125.8184033f, -122.5437829f, -119.2318345f, -115.8835669f,
//    -112.5f, -109.0821646f, -105.6311016f, -102.1478624f, -98.63350803f,
//    -95.08910889f, -91.51574469f, -87.91450391f, -84.28648352f, -80.63278865f,
//    -76.95453225f, -73.25283475f, -69.52882373f, -65.78363356f, -62.01840506f,
//    -58.23428515f, -54.43242651f, -50.61398723f, -46.78013043f, -42.93202396f,
//    -39.07083998f, -35.19775463f, -31.31394772f, -27.42060227f, -23.51890424f,
//    -19.61004212f, -15.69520659f, -11.77559015f, -7.852386758f, -3.926791448f,
//    0.0f, 3.926791448f, 7.852386758f, 11.77559015f, 15.69520659f,
//    19.61004212f, 23.51890424f, 27.42060227f, 31.31394772f, 35.19775463f,
//    39.07083998f, 42.93202396f, 46.78013043f, 50.61398723f, 54.43242651f,
//    58.23428515f, 62.01840506f, 65.78363356f, 69.52882373f, 73.25283475f,
//    76.95453225f, 80.63278865f, 84.28648352f, 87.91450391f, 91.51574469f,
//    95.08910889f, 98.63350803f, 102.1478624f, 105.6311016f, 109.0821646f,
//    112.5f, 115.8835669f, 119.2318345f, 122.5437829f, 125.8184033f,
//    129.0546982f, 132.2516818f, 135.4083802f, 138.5238319f, 141.597088f,
//    144.6272122f, 147.6132815f, 150.5543864f, 153.449631f, 156.2981334f,
//    159.0990258f, 161.8514551f, 164.5545829f, 167.2075857f, 169.8096556f,
//    172.3599997f, 174.8578413f, 177.3024196f, 179.6929898f, 182.0288237f,
//    184.30921f, 186.5334538f, 188.7008778f, 190.8108216f, 192.8626427f,
//    194.8557159f, 196.7894341f, 198.6632084f, 200.4764679f, 202.2286604f,
//    203.9192521f, 205.547728f, 207.113592f, 208.6163673f, 210.055596f,
//    211.4308397f, 212.7416795f, 213.9877162f, 215.1685701f, 216.2838816f,
//    217.3333109f, 218.3165384f, 219.2332646f, 220.0832102f, 220.8661163f,
//    221.5817444f, 222.2298766f, 222.8103155f, 223.3228841f, 223.7674265f,
//    224.1438071f, 224.4519113f, 224.6916453f, 224.8629361f, 224.9657314f,
//    225.0f, 224.9657314f, 224.8629361f, 224.6916453f, 224.4519113f,
//    224.1438071f, 223.7674265f, 223.3228841f, 222.8103155f, 222.2298766f,
//    221.5817444f, 220.8661163f, 220.0832102f, 219.2332646f, 218.3165384f,
//    217.3333109f, 216.2838816f, 215.1685701f, 213.9877162f, 212.7416795f,
//    211.4308397f, 210.055596f, 208.6163673f, 207.113592f, 205.547728f,
//    203.9192521f, 202.2286604f, 200.4764679f, 198.6632084f, 196.7894341f,
//    194.8557159f, 192.8626427f, 190.8108216f, 188.7008778f, 186.5334538f,
//    184.30921f, 182.0288237f, 179.6929898f, 177.3024196f, 174.8578413f,
//    172.3599997f, 169.8096556f, 167.2075857f, 164.5545829f, 161.8514551f,
//    159.0990258f, 156.2981334f, 153.449631f, 150.5543864f, 147.6132815f,
//    144.6272122f, 141.597088f, 138.5238319f, 135.4083802f, 132.2516818f,
//    129.0546982f, 125.8184033f, 122.5437829f, 119.2318345f, 115.8835669f,
//    112.5f, 109.0821646f, 105.6311016f, 102.1478624f, 98.63350803f,
//    95.08910889f, 91.51574469f, 87.91450391f, 84.28648352f, 80.63278865f,
//    76.95453225f, 73.25283475f, 69.52882373f, 65.78363356f, 62.01840506f,
//    58.23428515f, 54.43242651f, 50.61398723f, 46.78013043f, 42.93202396f,
//    39.07083998f, 35.19775463f, 31.31394772f, 27.42060227f, 23.51890424f,
//    19.61004212f, 15.69520659f, 11.77559015f, 7.852386758f, 3.926791448f,
//    0.0f, -3.926791448f, -7.852386758f, -11.77559015f, -15.69520659f,
//    -19.61004212f, -23.51890424f, -27.42060227f, -31.31394772f, -35.19775463f,
//    -39.07083998f, -42.93202396f, -46.78013043f, -50.61398723f, -54.43242651f,
//    -58.23428515f, -62.01840506f, -65.78363356f, -69.52882373f, -73.25283475f,
//    -76.95453225f, -80.63278865f, -84.28648352f, -87.91450391f, -91.51574469f,
//    -95.08910889f, -98.63350803f, -102.1478624f, -105.6311016f, -109.0821646f,
//    -112.5f, -115.8835669f, -119.2318345f, -122.5437829f, -125.8184033f,
//    -129.0546982f, -132.2516818f, -135.4083802f, -138.5238319f, -141.597088f,
//    -144.6272122f, -147.6132815f, -150.5543864f, -153.449631f, -156.2981334f,
//    -159.0990258f, -161.8514551f, -164.5545829f, -167.2075857f, -169.8096556f,
//    -172.3599997f, -174.8578413f, -177.3024196f, -179.6929898f, -182.0288237f,
//    -184.30921f, -186.5334538f, -188.7008778f, -190.8108216f, -192.8626427f
//};
//
//
//const float vc_array[] = {
//    194.8557159f, 192.8626427f, 190.8108216f, 188.7008778f, 186.5334538f,
//    184.30921f, 182.0288237f, 179.6929898f, 177.3024196f, 174.8578413f,
//    172.3599997f, 169.8096556f, 167.2075857f, 164.5545829f, 161.8514551f,
//    159.0990258f, 156.2981334f, 153.449631f, 150.5543864f, 147.6132815f,
//    144.6272122f, 141.597088f, 138.5238319f, 135.4083802f, 132.2516818f,
//    129.0546982f, 125.8184033f, 122.5437829f, 119.2318345f, 115.8835669f,
//    112.5f, 109.0821646f, 105.6311016f, 102.1478624f, 98.63350803f,
//    95.08910889f, 91.51574469f, 87.91450391f, 84.28648352f, 80.63278865f,
//    76.95453225f, 73.25283475f, 69.52882373f, 65.78363356f, 62.01840506f,
//    58.23428515f, 54.43242651f, 50.61398723f, 46.78013043f, 42.93202396f,
//    39.07083998f, 35.19775463f, 31.31394772f, 27.42060227f, 23.51890424f,
//    19.61004212f, 15.69520659f, 11.77559015f, 7.852386758f, 3.926791448f,
//    0.0f, -3.926791448f, -7.852386758f, -11.77559015f, -15.69520659f,
//    -19.61004212f, -23.51890424f, -27.42060227f, -31.31394772f, -35.19775463f,
//    -39.07083998f, -42.93202396f, -46.78013043f, -50.61398723f, -54.43242651f,
//    -58.23428515f, -62.01840506f, -65.78363356f, -69.52882373f, -73.25283475f,
//    -76.95453225f, -80.63278865f, -84.28648352f, -87.91450391f, -91.51574469f,
//    -95.08910889f, -98.63350803f, -102.1478624f, -105.6311016f, -109.0821646f,
//    -112.5f, -115.8835669f, -119.2318345f, -122.5437829f, -125.8184033f,
//    -129.0546982f, -132.2516818f, -135.4083802f, -138.5238319f, -141.597088f,
//    -144.6272122f, -147.6132815f, -150.5543864f, -153.449631f, -156.2981334f,
//    -159.0990258f, -161.8514551f, -164.5545829f, -167.2075857f, -169.8096556f,
//    -172.3599997f, -174.8578413f, -177.3024196f, -179.6929898f, -182.0288237f,
//    -184.30921f, -186.5334538f, -188.7008778f, -190.8108216f, -192.8626427f,
//    -194.8557159f, -196.7894341f, -198.6632084f, -200.4764679f, -202.2286604f,
//    -203.9192521f, -205.547728f, -207.113592f, -208.6163673f, -210.055596f,
//    -211.4308397f, -212.7416795f, -213.9877162f, -215.1685701f, -216.2838816f,
//    -217.3333109f, -218.3165384f, -219.2332646f, -220.0832102f, -220.8661163f,
//    -221.5817444f, -222.2298766f, -222.8103155f, -223.3228841f, -223.7674265f,
//    -224.1438071f, -224.4519113f, -224.6916453f, -224.8629361f, -224.9657314f,
//    -225.0f, -224.9657314f, -224.8629361f, -224.6916453f, -224.4519113f,
//    -224.1438071f, -223.7674265f, -223.3228841f, -222.8103155f, -222.2298766f,
//    -221.5817444f, -220.8661163f, -220.0832102f, -219.2332646f, -218.3165384f,
//    -217.3333109f, -216.2838816f, -215.1685701f, -213.9877162f, -212.7416795f,
//    -211.4308397f, -210.055596f, -208.6163673f, -207.113592f, -205.547728f,
//    -203.9192521f, -202.2286604f, -200.4764679f, -198.6632084f, -196.7894341f
//};










